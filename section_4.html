<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Section 4 - AI Adoption & Literacy</title>
		<style>
			:root {
			--bg: #f8fafc; --card: #ffffff; --border: #e5e7eb;
			--text: #111827; --muted: #6b7280; --accent: #2563eb; --divider: #f1f5f9;
			}
			* { box-sizing: border-box; }
			body { margin: 0; background: var(--bg); font-family: system-ui, -apple-system, sans-serif; color: var(--text); line-height: 1.5; }
			.container { max-width: 850px; padding: 20px 16px 60px; margin: auto; }
			.card { background: var(--card); border-radius: 14px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 30px; }
			h2 { font-size: 1.15rem; margin-bottom: 20px; color: var(--accent); }
			h3 { font-size: 1.1rem; color: var(--accent); margin: 30px 0 10px; }
			.q-wrap { margin-bottom: 35px; padding-bottom: 20px; border-bottom: 1px solid var(--divider); }
			.q-text { font-weight: 600; font-size: 1rem; margin-bottom: 12px; display: block; }
			.options-grid { display: flex; flex-direction: column; gap: 10px; }
			.opt-label { 
			display: flex; align-items: flex-start; padding: 12px; 
			border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: 0.2s; 
			}
			.opt-label:hover { background: #f8fafc; border-color: var(--accent); }
			.opt-label input { margin-top: 4px; margin-right: 12px; transform: scale(1.2); }
			/* Conditional Input Styling */
			.other-input-wrap { display: none; margin-top: 10px; padding-left: 10px; border-left: 3px solid var(--accent); }
			.other-text { 
			width: 100%; padding: 10px; border-radius: 6px; 
			border: 1px solid var(--border); font-size: 0.9rem; font-family: inherit;
			}
			.sticky-header { 
			position: sticky; top: 0; z-index: 100; background: #eff6ff; 
			border-bottom: 2px solid var(--accent); padding: 12px; font-weight: 700; 
			text-align: center; font-size: 0.85rem; margin-bottom: 15px;
			}
			table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
			th, td { padding: 12px 8px; text-align: center; border-bottom: 1px solid var(--divider); }
			.statement-text { text-align: left; width: 40%; font-size: 0.9rem; font-weight: 500; }
			textarea { 
			width: 100%; min-height: 80px; padding: 12px; border-radius: 8px; 
			border: 1px solid var(--border); font-family: inherit; margin-top: 15px;
			}
			.button-container {
			display: flex;            /* Enables Flexbox */
			justify-content: space-between; /* Puts space between the buttons */
			align-items: center;      /* Vertically centers them */
			margin-top: 30px;         /* Adds some breathing room above */
			gap: 10px;                /* Optional: space between buttons if the screen is small */
			}
			.next-area { text-align: right; margin-top: 30px; }
			#nextBtn {
			background: var(--accent);
			color: white;
			border: none;
			padding: 14px 40px;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			}
			.prev-area { text-align: left; margin-top: 30px; }
			#prevBtn {
			background: var(--accent);
			color: white;
			border: none;
			padding: 14px 40px;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			}
			.missing-field {
			border: 2px solid #ef4444 !important; /* Red border */
			background-color: #fef2f2 !important; /* Light red tint */
			padding: 10px;
			border-radius: 8px;
			}
			/* Specifically for table rows */
			tr.missing-field {
			outline: 2px solid #ff4d4d;
			}
			.modal-overlay {
			display: none; /* Hidden by default */
			position: fixed;
			top: 0; left: 0; width: 100%; height: 100%;
			background: rgba(0, 0, 0, 0.5); /* Dim the background */
			z-index: 1000;
			align-items: center;
			justify-content: center;
			}
			.modal-box {
			background: white;
			padding: 25px;
			border-radius: 12px;
			max-width: 400px;
			width: 90%;
			text-align: center;
			box-shadow: 0 10px 25px rgba(0,0,0,0.2);
			font-family: sans-serif;
			}
			.modal-box h3 { margin-top: 0; color: #333; }
			.modal-box p { color: #666; margin-bottom: 20px; }
			.modal-box button {
			background: #007bff;
			color: white;
			border: none;
			padding: 10px 30px;
			border-radius: 6px;
			cursor: pointer;
			font-size: 16px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="card">
				<h2>Workplace Support for AI in Research</h2>
				<p class="section-description"><b>Please indicate your agreement with statements about AI support in your workplace.</b></p>
				<div class="sticky-header">1: Strongly disagree | 2: Disagree | 3: Neither | 4: Agree | 5: Strongly agree</div>
				<table>
					<thead>
						<tr>
							<th>Statement</th>
							<th>1</th>
							<th>2</th>
							<th>3</th>
							<th>4</th>
							<th>5</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td class="statement-text">My workplace provides adequate computational resources for AI use in research</td>
							<td><input type="radio" name="q49_1" value="1"></td>
							<td><input type="radio" name="q49_1" value="2"></td>
							<td><input type="radio" name="q49_1" value="3"></td>
							<td><input type="radio" name="q49_1" value="4"></td>
							<td><input type="radio" name="q49_1" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">My workplace provides access to AI platforms necessary for my research</td>
							<td><input type="radio" name="q49_2" value="1"></td>
							<td><input type="radio" name="q49_2" value="2"></td>
							<td><input type="radio" name="q49_2" value="3"></td>
							<td><input type="radio" name="q49_2" value="4"></td>
							<td><input type="radio" name="q49_2" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">My workplace provides easy access to the datasets I need for AI-driven projects</td>
							<td><input type="radio" name="q49_3" value="1"></td>
							<td><input type="radio" name="q49_3" value="2"></td>
							<td><input type="radio" name="q49_3" value="3"></td>
							<td><input type="radio" name="q49_3" value="4"></td>
							<td><input type="radio" name="q49_3" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">My workplace offers formal training in AI, machine learning, or data science</td>
							<td><input type="radio" name="q50_1" value="1"></td>
							<td><input type="radio" name="q50_1" value="2"></td>
							<td><input type="radio" name="q50_1" value="3"></td>
							<td><input type="radio" name="q50_1" value="4"></td>
							<td><input type="radio" name="q50_1" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">There are sufficient opportunities for mentorship or collaboration in AI research within my workplace</td>
							<td><input type="radio" name="q50_2" value="1"></td>
							<td><input type="radio" name="q50_2" value="2"></td>
							<td><input type="radio" name="q50_2" value="3"></td>
							<td><input type="radio" name="q50_2" value="4"></td>
							<td><input type="radio" name="q50_2" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">I feel confident in my AI skills due to the training and support available at my workplace</td>
							<td><input type="radio" name="q50_3" value="1"></td>
							<td><input type="radio" name="q50_3" value="2"></td>
							<td><input type="radio" name="q50_3" value="3"></td>
							<td><input type="radio" name="q50_3" value="4"></td>
							<td><input type="radio" name="q50_3" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">My workplace has clear policies for ethical AI use in research</td>
							<td><input type="radio" name="q51_1" value="1"></td>
							<td><input type="radio" name="q51_1" value="2"></td>
							<td><input type="radio" name="q51_1" value="3"></td>
							<td><input type="radio" name="q51_1" value="4"></td>
							<td><input type="radio" name="q51_1" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Regulatory or compliance guidance for AI research is clearly provided by my workplace</td>
							<td><input type="radio" name="q51_2" value="1"></td>
							<td><input type="radio" name="q51_2" value="2"></td>
							<td><input type="radio" name="q51_2" value="3"></td>
							<td><input type="radio" name="q51_2" value="4"></td>
							<td><input type="radio" name="q51_2" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">My workplace actively encourages AI adoption in research projects</td>
							<td><input type="radio" name="q51_3" value="1"></td>
							<td><input type="radio" name="q51_3" value="2"></td>
							<td><input type="radio" name="q51_3" value="3"></td>
							<td><input type="radio" name="q51_3" value="4"></td>
							<td><input type="radio" name="q51_3" value="5"></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="card">
				<h2>Resources & Support for Responsible AI Use</h2>
				<p class="section-description">This section asks about the types of resources that may help reduce professional anxiety, cognitive overload, or uncertainty related to the use of AI in research.</p>
				<p><b>Please answer based on what would be <i>most helpful</i> for you, not what is currently available at your workplace.</b></p>
				<div class="q-wrap">
					<h3 class="q-title">A. Organizational Safeguards & Structural Support</h3>
					<p class="q-text"><b>Question:</b> Which workplace initiatives would most effectively reduce your professional uncertainty or anxiety regarding AI use?</p>
					<p class="q-instruction"><b>Instruction:</b> Please select <b>up to five (5)</b> options that you believe would be most helpful.</p>
					<div class="options-grid limit-5" data-name="q53">
						<h4 class="sub-group-title">Governance & Protection</h4>
						<label class="opt-label"><input type="checkbox" name="q53" value="1"> An ethics board or oversight process that provides an official “seal of approval” for AI tools used in research</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="2"> A clear legal indemnity policy that protects researchers from personal liability for AI-assisted errors</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="3"> Standardized templates for disclosing AI use in project proposals, manuscripts, and technical reports</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="4"> A centrally maintained list of officially vetted or approved AI models and tools</label>
						<h4 class="sub-group-title">Infrastructure & Time</h4>
						<label class="opt-label"><input type="checkbox" name="q53" value="5"> A dedicated AI helpdesk that provides technical support for debugging, bias detection, or unexpected AI behavior</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="6"> A secure internal AI “sandbox” that allows experimentation without risk of data leakage</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="7"> Protected learning time (e.g., sabbaticals or designated “AI learning days”)</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="8"> Adjusted workload or output expectations to account for the AI learning curve</label>
						<h4 class="sub-group-title">People & Career</h4>
						<label class="opt-label"><input type="checkbox" name="q53" value="9"> Mentorship or training for research leads and managers on managing AI use within teams</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="10"> Facilitated peer-to-peer discussion forums focused on AI-related anxiety, uncertainty, or professional identity</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="11"> Official organizational statements affirming the continued role of human expertise in future research</label>
						<label class="opt-label"><input type="checkbox" name="q53" value="12"> Dedicated funding mechanisms for research explicitly focused on human-AI collaboration</label>
					</div>
				</div>
				<div class="q-wrap">
					<h3 class="q-title">B. AI System Design & Transparency Features</h3>
					<p class="q-text"><b>Question:</b> How helpful would the following AI system features be in improving your trust in AI outputs and reducing concerns about overreliance or loss of professional judgment?</p>
					<p class="q-instruction"><b>Instruction:</b> Please select <b>up to five (5)</b> features that would be most helpful to you.</p>
					<div class="options-grid limit-5" data-name="q54">
						<h4 class="sub-group-title">Interpretability & Reasoning</h4>
						<label class="opt-label"><input type="checkbox" name="q54" value="1"> Visual, step-by-step explanations showing how the AI arrived at a given conclusion</label>
						<label class="opt-label"><input type="checkbox" name="q54" value="2"> Explanations that clarify why the AI selected one option over plausible alternatives</label>
						<label class="opt-label"><input type="checkbox" name="q54" value="3"> An interactive mode that allows you to ask the AI follow-up questions such as “Why did you ignore this variable?”</label>
						<h4 class="sub-group-title">Reliability & Error Detection</h4>
						<label class="opt-label"><input type="checkbox" name="q54" value="4"> Confidence or uncertainty estimates displayed alongside each AI output</label>
						<label class="opt-label"><input type="checkbox" name="q54" value="5"> Automated alerts when the model is likely hallucinating or extrapolating beyond its training data</label>
						<label class="opt-label"><input type="checkbox" name="q54" value="6"> Built-in validation checks or plausibility flags that indicate potentially incorrect outputs</label>
						<h4 class="sub-group-title">Accountability & Control</h4>
						<label class="opt-label"><input type="checkbox" name="q54" value="7"> Mandatory human sign-off checkpoints before AI-generated code, analyses, or text are finalized</label>
						<label class="opt-label"><input type="checkbox" name="q54" value="8"> Clear tracking of model versions, datasets, and parameters used for each result</label>
						<label class="opt-label"><input type="checkbox" name="q54" value="9"> Ability to easily override, correct, or reject AI-generated suggestions</label>
						<h4 class="sub-group-title">Fairness & Attribution</h4>
						<label class="opt-label"><input type="checkbox" name="q54" value="10"> Explicit citations or links to the data sources or supporting documentation informing AI outputs</label>
						<label class="opt-label"><input type="checkbox" name="q54" value="11"> Dashboards that display potential bias or data imbalance in model training or outputs</label>
						<label class="opt-label"><input type="checkbox" name="q54" value="12"> Tools that allow users to explore how outputs change under different assumptions or inputs</label>
					</div>
				</div>
				<div class="q-wrap">
					<h3 class="q-title">C. Skills & Professional Development Needs</h3>
					<p class="q-text"><b>Question:</b> Which educational or professional development interventions would most help address feelings of imposter syndrome, trend overload, or loss of confidence related to AI use?</p>
					<p class="q-instruction"><b>Instruction:</b> Please select <b>up to five (5)</b> options.</p>
					<div class="options-grid limit-5" data-name="q55">
						<h4 class="sub-group-title">Foundational Understanding</h4>
						<label class="opt-label"><input type="checkbox" name="q55" value="1"> A non-technical course explaining how modern AI and machine learning systems work and where they commonly fail</label>
						<label class="opt-label"><input type="checkbox" name="q55" value="2"> A hands-on ethics and privacy workshop focused on data governance, intellectual property, and responsible AI use</label>
						<label class="opt-label"><input type="checkbox" name="q55" value="3"> Plain-language instruction on core AI concepts, terminology, and common misconceptions</label>
						<h4 class="sub-group-title">Applied Capability</h4>
						<label class="opt-label"><input type="checkbox" name="q55" value="4"> An applied coding bootcamp (e.g., Python or R) focused on integrating AI tools into real research workflows</label>
						<label class="opt-label"><input type="checkbox" name="q55" value="5"> Structured guidance for mapping AI tools onto your own daily research tasks and decision points</label>
						<label class="opt-label"><input type="checkbox" name="q55" value="6"> Field-specific “show-and-tell” sessions where peers demonstrate how they use AI in similar research contexts</label>
						<h4 class="sub-group-title">Judgment & Oversight</h4>
						<label class="opt-label"><input type="checkbox" name="q55" value="7"> Training on how to audit, validate, and critically review AI-generated analyses or code</label>
						<label class="opt-label"><input type="checkbox" name="q55" value="8"> Workshops focused on maintaining skepticism, recognizing automation bias, and avoiding blind trust in AI outputs</label>
						<label class="opt-label"><input type="checkbox" name="q55" value="9"> Case-based discussions of real examples where AI use led to errors or misleading conclusions</label>
						<h4 class="sub-group-title">Career Context</h4>
						<label class="opt-label"><input type="checkbox" name="q55" value="10"> Career-oriented seminars focused on how research roles and expectations may evolve over the next five years</label>
						<label class="opt-label"><input type="checkbox" name="q55" value="11"> Guidance on authorship, credit, and responsibility when AI tools are used in research</label>
						<label class="opt-label"><input type="checkbox" name="q55" value="12"> Mentorship or coaching on navigating professional identity changes related to AI adoption</label>
					</div>
				</div>
			</div>
			<div class="card">
				<h3 class="q-title">D. Formal Training</h3>
				<p class="q-text"><b>Question:</b> If your workplace offered the following training modules, how likely would you be to enroll?</p>
				<div class="sticky-header">1 = Not at all likely | 2 = Slightly unlikely | 3 = Neutral / unsure | 4 = Likely | 5 = Extremely likely</div>
				<table>
					<thead>
						<tr>
							<th>Training Module</th>
							<th>1</th>
							<th>2</th>
							<th>3</th>
							<th>4</th>
							<th>5</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td class="statement-text">Foundations: Basic machine learning concepts and “black box” mechanics</td>
							<td><input type="radio" name="q56_1" value="1"></td>
							<td><input type="radio" name="q56_1" value="2"></td>
							<td><input type="radio" name="q56_1" value="3"></td>
							<td><input type="radio" name="q56_1" value="4"></td>
							<td><input type="radio" name="q56_1" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Technical Skills: Practical coding (e.g., Python or R) for AI integration</td>
							<td><input type="radio" name="q56_2" value="1"></td>
							<td><input type="radio" name="q56_2" value="2"></td>
							<td><input type="radio" name="q56_2" value="3"></td>
							<td><input type="radio" name="q56_2" value="4"></td>
							<td><input type="radio" name="q56_2" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Workflow Optimization: Plug-and-play AI methods for immediate use in your research tasks</td>
							<td><input type="radio" name="q56_3" value="1"></td>
							<td><input type="radio" name="q56_3" value="2"></td>
							<td><input type="radio" name="q56_3" value="3"></td>
							<td><input type="radio" name="q56_3" value="4"></td>
							<td><input type="radio" name="q56_3" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Verification & Auditing: Techniques for validating AI outputs and detecting errors or hallucinations</td>
							<td><input type="radio" name="q56_4" value="1"></td>
							<td><input type="radio" name="q56_4" value="2"></td>
							<td><input type="radio" name="q56_4" value="3"></td>
							<td><input type="radio" name="q56_4" value="4"></td>
							<td><input type="radio" name="q56_4" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Interpretability & Model Insight: Understanding how AI systems generate specific outputs</td>
							<td><input type="radio" name="q56_5" value="1"></td>
							<td><input type="radio" name="q56_5" value="2"></td>
							<td><input type="radio" name="q56_5" value="3"></td>
							<td><input type="radio" name="q56_5" value="4"></td>
							<td><input type="radio" name="q56_5" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Ethical, Regulatory & Authorship Practices: Responsible use, disclosure norms, and accountability</td>
							<td><input type="radio" name="q56_6" value="1"></td>
							<td><input type="radio" name="q56_6" value="2"></td>
							<td><input type="radio" name="q56_6" value="3"></td>
							<td><input type="radio" name="q56_6" value="4"></td>
							<td><input type="radio" name="q56_6" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Strategic Use & Boundary Setting: Deciding when—and when not—to use AI in research workflows</td>
							<td><input type="radio" name="q56_7" value="1"></td>
							<td><input type="radio" name="q56_7" value="2"></td>
							<td><input type="radio" name="q56_7" value="3"></td>
							<td><input type="radio" name="q56_7" value="4"></td>
							<td><input type="radio" name="q56_7" value="5"></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="card">
				<h3 class="q-title">E. Information Support</h3>
				<p class="q-text"><b>Question:</b> Outside of formal training, which of the following resources would most help you stay oriented to AI developments while minimizing cognitive overload or information fatigue?</p>
				<p class="q-instruction"><b>Instruction:</b> Please rate how helpful each option would be for you.</p>
				<div class="sticky-header">1 = Not helpful | 2 = Slightly helpful | 3 = Moderately helpful | 4 = Very helpful | 5 = Extremely helpful</div>
				<table>
					<thead>
						<tr>
							<th>Resource Type</th>
							<th>1</th>
							<th>2</th>
							<th>3</th>
							<th>4</th>
							<th>5</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td class="statement-text">Curated summaries of AI developments filtered for relevance to my research field</td>
							<td><input type="radio" name="q57_1" value="1"></td>
							<td><input type="radio" name="q57_1" value="2"></td>
							<td><input type="radio" name="q57_1" value="3"></td>
							<td><input type="radio" name="q57_1" value="4"></td>
							<td><input type="radio" name="q57_1" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Expert-led talks or commentaries that interpret recent AI trends</td>
							<td><input type="radio" name="q57_2" value="1"></td>
							<td><input type="radio" name="q57_2" value="2"></td>
							<td><input type="radio" name="q57_2" value="3"></td>
							<td><input type="radio" name="q57_2" value="4"></td>
							<td><input type="radio" name="q57_2" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Case studies or examples shared by peers in similar research roles</td>
							<td><input type="radio" name="q57_3" value="1"></td>
							<td><input type="radio" name="q57_3" value="2"></td>
							<td><input type="radio" name="q57_3" value="3"></td>
							<td><input type="radio" name="q57_3" value="4"></td>
							<td><input type="radio" name="q57_3" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Clear guidance on which AI tools to use, when to use them, and why</td>
							<td><input type="radio" name="q57_4" value="1"></td>
							<td><input type="radio" name="q57_4" value="2"></td>
							<td><input type="radio" name="q57_4" value="3"></td>
							<td><input type="radio" name="q57_4" value="4"></td>
							<td><input type="radio" name="q57_4" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">Explicit guidance on situations where AI is not appropriate or advisable</td>
							<td><input type="radio" name="q57_5" value="1"></td>
							<td><input type="radio" name="q57_5" value="2"></td>
							<td><input type="radio" name="q57_5" value="3"></td>
							<td><input type="radio" name="q57_5" value="4"></td>
							<td><input type="radio" name="q57_5" value="5"></td>
						</tr>
						<tr>
							<td class="statement-text">I prefer to stay current through unstructured, self-directed exploration rather than organized resources</td>
							<td><input type="radio" name="q57_6" value="1"></td>
							<td><input type="radio" name="q57_6" value="2"></td>
							<td><input type="radio" name="q57_6" value="3"></td>
							<td><input type="radio" name="q57_6" value="4"></td>
							<td><input type="radio" name="q57_6" value="5"></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="card">
				<h2>F. Overall Priority</h2>
				<div class="q-wrap">
					<span class="q-text">If only one area could be improved at your workplace, which would most reduce your AI-related stress or uncertainty?</span>
					<div class="options-grid">
						<label class="opt-label"><input type="radio" name="q58" value="1"> Organizational policies and protections</label>
						<label class="opt-label"><input type="radio" name="q58" value="2"> Transparency and design of AI systems</label>
						<label class="opt-label"><input type="radio" name="q58" value="3"> Skill development and professional training</label>
						<label class="opt-label"><input type="radio" name="q58" value="4"> Access to training opportunities</label>
						<label class="opt-label"><input type="radio" name="q58" value="5"> Information filtering and sense-making support</label>
					</div>
				</div>
			</div>
			<div class="button-container">
				<button id="prevBtn" type="button" class="btn-secondary">Previous</button>
				<button id="nextBtn" type="button" class="btn-primary">Submit</button>
			</div>
		</div>
		<div id="customAlert" class="modal-overlay">
			<div class="modal-box">
				<h3>Incomplete Questions</h3>
				<p>It looks like you missed some questions. We've highlighted them for you.</p>
				<button id="closeAlertBtn" type="button">OK</button>
			</div>
		</div>
	</body>
	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
		import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
		
		// --- 1. FIREBASE CONFIG ---
		const firebaseConfig = {
		    apiKey: "AIzaSyCoHmEBbmo9JB8M69O5Udu_9aVZC7ZOEPc",
		    authDomain: "research-healthai-perception.firebaseapp.com",
		    projectId: "research-healthai-perception",
		    storageBucket: "research-healthai-perception.firebasestorage.app",
		    messagingSenderId: "711118612360",
		    appId: "1:711118612360:web:466d7bce64aa56954d7c3d",
		    measurementId: "G-R33FXV0290"
		};
		
		const app = initializeApp(firebaseConfig);
		const db = getFirestore(app);
		
		// --- 2. IDENTITY & TIMING ---
		const uid = localStorage.getItem('survey_uid') || 'anonymous';
		
		const getFormattedDate = (date = new Date()) => {
		    const pad = (num, size) => num.toString().padStart(size, '0');
		    const y = date.getFullYear();
		    const m = pad(date.getMonth() + 1, 2);
		    const d = pad(date.getDate(), 2);
		    const h = pad(date.getHours(), 2);
		    const min = pad(date.getMinutes(), 2);
		    const s = pad(date.getSeconds(), 2);
		    const ms = pad(date.getMilliseconds(), 3);
		    return `${y}-${m}-${d} ${h}:${min}:${s}.${ms}`;
		};
		
		const startLocal = getFormattedDate();
		const startUTC = new Date().toISOString().replace('T', ' ').replace('Z', ''); 
		
		// --- 3. SYNC DATA FUNCTION ---
		async function syncData() {
		    const getRadio = (name) => {
		        const val = document.querySelector(`input[name="${name}"]:checked`)?.value;
		        return val ? parseInt(val) : 0;
		    };
		
		    const getCheckboxes = (name) => {
		        const checked = Array.from(document.querySelectorAll(`input[name="${name}"]:checked`));
		        return checked.map(cb => parseInt(cb.value));
		    };
		
		    const getText = (name) => document.querySelector(`[name="${name}"]`)?.value || "";
		
		    const payload = {
		        uid: uid,
		        // OBJECT A: Structured Research Data
		        section_4: {
		            metadata: {
		                start_local: startLocal,
		                start_utc: startUTC,
		                last_sync_local: getFormattedDate(),
		                server_ts: serverTimestamp()
		            },
		            q49_resources: [getRadio('q49_1'), getRadio('q49_2'), getRadio('q49_3')],
		            q50_training: [getRadio('q50_1'), getRadio('q50_2'), getRadio('q50_3')],
		            q51_policy: [getRadio('q51_1'), getRadio('q51_2'), getRadio('q51_3')],
		            q53_org_safeguards: getCheckboxes('q53'),
		            q54_system_design: getCheckboxes('q54'),
		            q55_skills_dev: getCheckboxes('q55'),
		            q56_training_likelihood: [
		                getRadio('q56_1'), getRadio('q56_2'), getRadio('q56_3'),
		                getRadio('q56_4'), getRadio('q56_5'), getRadio('q56_6'), getRadio('q56_7')
		            ],
		            q57_info_support: [
		                getRadio('q57_1'), getRadio('q57_2'), getRadio('q57_3'),
		                getRadio('q57_4'), getRadio('q57_5'), getRadio('q57_6')
		            ],
		            q58_overall_priority: getRadio('q58')
		        },
		        // OBJECT B: UI State for Persistence
		        form_state_4: {
		            radios: Array.from(document.querySelectorAll('input[type="radio"]:checked')).map(r => ({name: r.name, val: r.value})),
		            checkboxes: Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(c => ({name: c.name, val: c.value})),
		            textInputs: Array.from(document.querySelectorAll('input[type="text"]')).map(t => ({name: t.name, val: t.value}))
		        }
		    };
		
		    try {
		        await setDoc(doc(db, "survey_data", uid), payload, { merge: true });
		        console.log("Section 4 synced.");
		    } catch (e) {
		        console.error("Firebase Error: ", e);
		    }
		}
		
		// --- 4. RESUME LOGIC ---
		async function loadAndRestore() {
		    try {
		        const docRef = doc(db, "survey_data", uid);
		        const docSnap = await getDoc(docRef);
		
		        if (docSnap.exists() && docSnap.data().form_state_4) {
		            const state = docSnap.data().form_state_4;
		            console.log("Restoring Section 4 progress...");
		
		            if (state.radios) {
		                state.radios.forEach(r => {
		                    const el = document.querySelector(`input[name="${r.name}"][value="${r.val}"]`);
		                    if (el) el.checked = true;
		                });
		            }
		            if (state.checkboxes) {
		                state.checkboxes.forEach(c => {
		                    const el = document.querySelector(`input[name="${c.name}"][value="${c.val}"]`);
		                    if (el) {
		                    el.checked = true;
		                    // Trigger change to handle any "Other" visibility toggles
		                    el.dispatchEvent(new Event('change', { bubbles: true }));
		                    }
		                });
		            }
		            if (state.textInputs) {
		                state.textInputs.forEach(t => {
		                    const el = document.querySelector(`input[name="${t.name}"]`);
		                    if (el) el.value = t.val;
		                });
		            }
		        }
		    } catch (e) { console.error("Restore error:", e); }
		    initListeners();
		}
		
		// This makes the function "Global" so the HTML button can see it
		window.closeAlert = function() {
		    const modal = document.getElementById('customAlert');
		    if (modal) {
		        modal.style.display = 'none';
		    }
		};
		
		function initListeners() {
		    // Add this inside the initListeners() function:
		    document.getElementById('closeAlertBtn')?.addEventListener('click', window.closeAlert);
		    document.addEventListener('change', (e) => {
		    
		        // Limit logic
		        const limitedGroups = ['q53', 'q54', 'q55'];
		        if (limitedGroups.includes(e.target.name)) {
		            const checkedBoxes = document.querySelectorAll(`input[name="${e.target.name}"]:checked`);
		            if (checkedBoxes.length > 5) {
		                e.target.checked = false;
		                alert("Please select a maximum of 5 options for this category.");
		                return; 
		            }
		        }
		
		        if (e.target.type === 'radio' || e.target.type === 'checkbox') {
		            syncData();
		        }
		
		        // Other visibility
		        if (e.target.classList.contains('other-trigger')) {
		            const wrap = e.target.closest('.opt-label').nextElementSibling;
		            if (wrap && wrap.classList.contains('other-input-wrap')) {
		            wrap.style.display = e.target.checked ? 'block' : 'none';
		            }
		        }
		    });
		
		    document.querySelectorAll('input[type="text"]').forEach(txt => {
		        txt.addEventListener('input', syncData);
		    });
		}
		
		// --- 5. VALIDATION & FINAL SUBMISSION ---
		let validationAttempts = 0;
		
		document.getElementById('nextBtn').addEventListener('click', async () => {
		    document.querySelectorAll('.missing-field').forEach(el => el.classList.remove('missing-field'));
		    let missingAny = false;
		
		    // Checkboxes (At least one)
		    ['q53', 'q54', 'q55'].forEach(q => {
		        if (document.querySelectorAll(`input[name="${q}"]:checked`).length === 0) {
		            document.querySelector(`input[name="${q}"]`)?.closest('.q-wrap')?.classList.add('missing-field');
		            missingAny = true;
		        }
		    });
		
		    // Single Radio
		    if (!document.querySelector(`input[name="q58"]:checked`)) {
		        document.getElementsByName('q58')[0]?.closest('.q-wrap')?.classList.add('missing-field');
		        missingAny = true;
		    }
		
		    // Matrices
		    const matrixMap = { 'q49': 3, 'q50': 3, 'q51': 3, 'q56': 7, 'q57': 6 };
		    Object.keys(matrixMap).forEach(base => {
		        for (let i = 1; i <= matrixMap[base]; i++) {
		            if (!document.querySelector(`input[name="${base}_${i}"]:checked`)) {
		                document.querySelector(`input[name="${base}_${i}"]`)?.closest('tr')?.classList.add('missing-field');
		                missingAny = true;
		            }
		        }
		    });
		
		    if (missingAny && validationAttempts === 0) {
		        document.getElementById('customAlert').style.display = 'flex';
		
		        validationAttempts++;
		        document.querySelector('.missing-field')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
		        return;
		    }
		    
		
		    const btn = document.getElementById('nextBtn');
		    btn.disabled = true;
		    btn.innerText = "Finalizing...";
		
		    await syncData();
		    
		    // Final UI transformation
		    document.querySelector('.container').innerHTML = `
		        <div class="card" style="text-align: center; padding: 50px;">
		            <h2>Submission Successful!</h2>
		            <p>Thank you for participating in our research. Your responses have been securely saved.</p>
		        </div>`;
		});
		
		// PREVIOUS BUTTON LOGIC (No validation needed to go back)
		const prevBtn = document.getElementById('prevBtn');
		if (prevBtn) {
		    prevBtn.addEventListener('click', async () => {
		        prevBtn.disabled = true;
		        prevBtn.innerText = "Saving...";
		        
		        await syncData(); // Save whatever they have before going back
		        window.location.href = "section_3.html";
		    });
		}
		
		loadAndRestore();
	</script>
</html>